<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢é¤ç³»ç»Ÿ - ç®¡ç†åå°</title>
    <link href="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.css" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 20px;
        }
        .section-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            font-size: 16px;
        }
        .section-content {
            padding: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-box {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        .actions-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        @media (max-width: 768px) {
            .admin-container {
                padding: 0 10px 20px;
            }
            .section-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="admin-header">
            <h1>ğŸ› ï¸ è®¢é¤ç³»ç»Ÿç®¡ç†åå°</h1>
            <p>ç³»ç»Ÿé…ç½®ä¸æ•°æ®ç®¡ç†</p>
        </div>

        <div class="admin-container">
            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="section-card">
                <div class="section-header">ğŸ“Š ä»Šæ—¥ç»Ÿè®¡æ¦‚è§ˆ</div>
                <div class="section-content">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number">{{ stats.totalEmployees }}</div>
                            <div class="stat-label">æ€»å‘˜å·¥æ•°</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">{{ stats.lunchOrders }}</div>
                            <div class="stat-label">åˆé¤è®¢é¤</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">{{ stats.dinnerOrders }}</div>
                            <div class="stat-label">æ™šé¤è®¢é¤</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">{{ stats.totalRatings }}</div>
                            <div class="stat-label">ä»Šæ—¥è¯„ä»·æ•°</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å‘˜å·¥ç®¡ç† -->
            <div class="section-card">
                <div class="section-header">ğŸ‘¥ å‘˜å·¥ç®¡ç†</div>
                <div class="section-content">
                    <div class="actions-bar">
                        <el-button type="primary" @click="showAddEmployeeDialog">æ·»åŠ å‘˜å·¥</el-button>
                        <el-button @click="loadEmployees">åˆ·æ–°æ•°æ®</el-button>
                    </div>
                    
                    <el-table :data="employees" stripe style="width: 100%">
                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                        <el-table-column prop="name" label="å§“å"></el-table-column>
                        <el-table-column prop="department" label="éƒ¨é—¨"></el-table-column>
                        <el-table-column prop="active" label="çŠ¶æ€">
                            <template #default="scope">
                                <el-tag :type="scope.row.active ? 'success' : 'danger'">
                                    {{ scope.row.active ? 'æ¿€æ´»' : 'ç¦ç”¨' }}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column label="æ“ä½œ" width="150">
                            <template #default="scope">
                                <el-button size="small" @click="editEmployee(scope.row)">ç¼–è¾‘</el-button>
                                <el-button size="small" type="danger" @click="deleteEmployee(scope.row.id)">åˆ é™¤</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>

            <!-- é¥­åº—ç®¡ç† -->
            <div class="section-card">
                <div class="section-header">ğŸª é¥­åº—ç®¡ç†</div>
                <div class="section-content">
                    <div class="actions-bar">
                        <el-button type="primary" @click="showAddRestaurantDialog">æ·»åŠ é¥­åº—</el-button>
                        <el-button @click="loadRestaurants">åˆ·æ–°æ•°æ®</el-button>
                    </div>
                    
                    <el-table :data="restaurants" stripe style="width: 100%">
                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                        <el-table-column prop="name" label="é¥­åº—åç§°"></el-table-column>
                        <el-table-column prop="description" label="æè¿°"></el-table-column>
                        <el-table-column prop="phone" label="ç”µè¯"></el-table-column>
                        <el-table-column prop="address" label="åœ°å€"></el-table-column>
                        <el-table-column prop="availableDays" label="è¥ä¸šæ—¥">
                            <template #default="scope">
                                <el-tag v-for="day in scope.row.availableDays" :key="day" size="small" style="margin-right: 4px;">
                                    {{ getDayNameByNum(day) }}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column label="æ“ä½œ" width="150">
                            <template #default="scope">
                                <el-button size="small" @click="editRestaurant(scope.row)">ç¼–è¾‘</el-button>
                                <el-button size="small" type="danger" @click="deleteRestaurant(scope.row.id)">åˆ é™¤</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>

            <!-- èœå“ç®¡ç† -->
            <div class="section-card">
                <div class="section-header">ğŸ½ï¸ èœå“ç®¡ç†</div>
                <div class="section-content">
                    <div class="actions-bar">
                        <el-button type="primary" @click="showAddDishDialog">æ·»åŠ èœå“</el-button>
                        <el-button type="success" @click="generateMenu">é‡æ–°ç”Ÿæˆæœ¬å‘¨èœå•</el-button>
                        <el-button @click="loadDishes">åˆ·æ–°æ•°æ®</el-button>
                    </div>
                    
                    <el-table :data="dishes" stripe style="width: 100%">
                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                        <el-table-column prop="name" label="èœå"></el-table-column>
                        <el-table-column prop="description" label="æè¿°"></el-table-column>
                        <el-table-column prop="category" label="ç±»åˆ«"></el-table-column>
                        <el-table-column prop="restaurantId" label="æ‰€å±é¥­åº—">
                            <template #default="scope">
                                {{ getRestaurantName(scope.row.restaurantId) }}
                            </template>
                        </el-table-column>
                        <el-table-column prop="price" label="ä»·æ ¼">
                            <template #default="scope">
                                Â¥{{ scope.row.price }}
                            </template>
                        </el-table-column>
                        <el-table-column label="æ“ä½œ" width="150">
                            <template #default="scope">
                                <el-button size="small" @click="editDish(scope.row)">ç¼–è¾‘</el-button>
                                <el-button size="small" type="danger" @click="deleteDish(scope.row.id)">åˆ é™¤</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div class="section-card">
                <div class="section-header">âš™ï¸ ç³»ç»Ÿè®¾ç½®</div>
                <div class="section-content">
                    <el-form :model="settings" label-width="120px">
                        <el-form-item label="æ€»å‘˜å·¥æ•°">
                            <el-input-number v-model="settings.totalEmployees" :min="1" :max="1000"></el-input-number>
                        </el-form-item>
                        <el-form-item label="åˆé¤ç™»è®°æ—¶é—´">
                            <el-time-picker v-model="settings.lunchOpenTime" format="HH:mm" value-format="HH:mm"></el-time-picker>
                        </el-form-item>
                        <el-form-item label="æ™šé¤ç™»è®°æ—¶é—´">
                            <el-time-picker v-model="settings.dinnerOpenTime" format="HH:mm" value-format="HH:mm"></el-time-picker>
                        </el-form-item>
                        <el-form-item label="èœå•ç”Ÿæˆæ—¶é—´">
                            <el-time-picker v-model="settings.menuGenerateTime" format="HH:mm" value-format="HH:mm"></el-time-picker>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="saveSettings">ä¿å­˜è®¾ç½®</el-button>
                        </el-form-item>
                    </el-form>
                </div>
            </div>

            <!-- æ•°æ®å¯¼å‡º -->
            <div class="section-card">
                <div class="section-header">ğŸ“Š æ•°æ®å¯¼å‡º</div>
                <div class="section-content">
                    <div class="actions-bar">
                        <el-button type="success" @click="exportData('employees')">å¯¼å‡ºå‘˜å·¥æ•°æ®</el-button>
                        <el-button type="success" @click="exportData('dishes')">å¯¼å‡ºèœå“æ•°æ®</el-button>
                        <el-button type="success" @click="exportData('ratings')">å¯¼å‡ºè¯„ä»·æ•°æ®</el-button>
                        <el-button type="success" @click="exportData('orders')">å¯¼å‡ºè®¢é¤ç»Ÿè®¡</el-button>
                        <el-button type="warning" @click="exportAllData">å¯¼å‡ºæ‰€æœ‰æ•°æ®</el-button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å‘˜å·¥ç¼–è¾‘å¯¹è¯æ¡† -->
        <el-dialog v-model="employeeDialogVisible" :title="editingEmployee.id ? 'ç¼–è¾‘å‘˜å·¥' : 'æ·»åŠ å‘˜å·¥'">
            <el-form :model="editingEmployee" label-width="80px">
                <el-form-item label="å§“å">
                    <el-input v-model="editingEmployee.name" placeholder="è¯·è¾“å…¥å‘˜å·¥å§“å"></el-input>
                </el-form-item>
                <el-form-item label="éƒ¨é—¨">
                    <el-input v-model="editingEmployee.department" placeholder="è¯·è¾“å…¥éƒ¨é—¨"></el-input>
                </el-form-item>
                <el-form-item label="çŠ¶æ€">
                    <el-switch v-model="editingEmployee.active" active-text="æ¿€æ´»" inactive-text="ç¦ç”¨"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="employeeDialogVisible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="saveEmployee">ä¿å­˜</el-button>
            </template>
        </el-dialog>

        <!-- é¥­åº—ç¼–è¾‘å¯¹è¯æ¡† -->
        <el-dialog v-model="restaurantDialogVisible" :title="editingRestaurant.id ? 'ç¼–è¾‘é¥­åº—' : 'æ·»åŠ é¥­åº—'">
            <el-form :model="editingRestaurant" label-width="80px">
                <el-form-item label="é¥­åº—åç§°">
                    <el-input v-model="editingRestaurant.name" placeholder="è¯·è¾“å…¥é¥­åº—åç§°"></el-input>
                </el-form-item>
                <el-form-item label="æè¿°">
                    <el-input v-model="editingRestaurant.description" placeholder="è¯·è¾“å…¥æè¿°"></el-input>
                </el-form-item>
                <el-form-item label="ç”µè¯">
                    <el-input v-model="editingRestaurant.phone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯"></el-input>
                </el-form-item>
                <el-form-item label="åœ°å€">
                    <el-input v-model="editingRestaurant.address" placeholder="è¯·è¾“å…¥åœ°å€"></el-input>
                </el-form-item>
                <el-form-item label="è¥ä¸šæ—¥">
                    <el-checkbox-group v-model="editingRestaurant.availableDays">
                        <el-checkbox :label="1">å‘¨ä¸€</el-checkbox>
                        <el-checkbox :label="2">å‘¨äºŒ</el-checkbox>
                        <el-checkbox :label="3">å‘¨ä¸‰</el-checkbox>
                        <el-checkbox :label="4">å‘¨å››</el-checkbox>
                        <el-checkbox :label="5">å‘¨äº”</el-checkbox>
                    </el-checkbox-group>
                </el-form-item>
                <el-form-item label="çŠ¶æ€">
                    <el-switch v-model="editingRestaurant.active" active-text="å¯ç”¨" inactive-text="ç¦ç”¨"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="restaurantDialogVisible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="saveRestaurant">ä¿å­˜</el-button>
            </template>
        </el-dialog>

        <!-- èœå“ç¼–è¾‘å¯¹è¯æ¡† -->
        <el-dialog v-model="dishDialogVisible" :title="editingDish.id ? 'ç¼–è¾‘èœå“' : 'æ·»åŠ èœå“'">
            <el-form :model="editingDish" label-width="80px">
                <el-form-item label="èœå">
                    <el-input v-model="editingDish.name" placeholder="è¯·è¾“å…¥èœå"></el-input>
                </el-form-item>
                <el-form-item label="æè¿°">
                    <el-input v-model="editingDish.description" placeholder="è¯·è¾“å…¥èœå“æè¿°"></el-input>
                </el-form-item>
                <el-form-item label="ç±»åˆ«">
                    <el-select v-model="editingDish.category" placeholder="é€‰æ‹©ç±»åˆ«">
                        <el-option label="è¤èœ" value="è¤èœ"></el-option>
                        <el-option label="ç´ èœ" value="ç´ èœ"></el-option>
                        <el-option label="æ±¤" value="æ±¤"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="æ‰€å±é¥­åº—">
                    <el-select v-model="editingDish.restaurantId" placeholder="é€‰æ‹©é¥­åº—">
                        <el-option v-for="restaurant in restaurants" :key="restaurant.id" 
                                   :label="restaurant.name" :value="restaurant.id">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="ä»·æ ¼">
                    <el-input-number v-model="editingDish.price" :precision="2" :step="0.5" :min="0"></el-input-number>
                </el-form-item>
                <el-form-item label="çŠ¶æ€">
                    <el-switch v-model="editingDish.active" active-text="å¯ç”¨" inactive-text="ç¦ç”¨"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dishDialogVisible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="saveDish">ä¿å­˜</el-button>
            </template>
        </el-dialog>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.8/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.full.js"></script>
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    stats: {
                        totalEmployees: 0,
                        lunchOrders: 0,
                        dinnerOrders: 0,
                        totalRatings: 0
                    },
                    employees: [],
                    restaurants: [],
                    dishes: [],
                    settings: {
                        totalEmployees: 50,
                        lunchOpenTime: '10:00',
                        dinnerOpenTime: '16:00',
                        menuGenerateTime: '09:00'
                    },
                    employeeDialogVisible: false,
                    restaurantDialogVisible: false,
                    dishDialogVisible: false,
                    editingEmployee: {
                        name: '',
                        department: '',
                        active: true
                    },
                    editingRestaurant: {
                        name: '',
                        description: '',
                        phone: '',
                        address: '',
                        availableDays: [1, 2, 3, 4, 5],
                        active: true
                    },
                    editingDish: {
                        name: '',
                        description: '',
                        category: 'è¤èœ',
                        restaurantId: null,
                        price: 0,
                        active: true
                    }
                };
            },
            mounted() {
                this.loadAllData();
            },
            methods: {
                async loadAllData() {
                    await Promise.all([
                        this.loadStats(),
                        this.loadEmployees(),
                        this.loadRestaurants(),
                        this.loadDishes(),
                        this.loadSettings()
                    ]);
                },
                async loadStats() {
                    try {
                        const response = await fetch('/api/admin/stats');
                        const result = await response.json();
                        if (result.success) {
                            this.stats = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    }
                },
                async loadEmployees() {
                    try {
                        const response = await fetch('/api/admin/employees');
                        const result = await response.json();
                        if (result.success) {
                            this.employees = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½å‘˜å·¥æ•°æ®å¤±è´¥:', error);
                    }
                },
                async loadRestaurants() {
                    try {
                        const response = await fetch('/api/admin/restaurants');
                        const result = await response.json();
                        if (result.success) {
                            this.restaurants = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½é¥­åº—æ•°æ®å¤±è´¥:', error);
                    }
                },
                async loadDishes() {
                    try {
                        const response = await fetch('/api/admin/dishes');
                        const result = await response.json();
                        if (result.success) {
                            this.dishes = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½èœå“æ•°æ®å¤±è´¥:', error);
                    }
                },
                async loadSettings() {
                    try {
                        const response = await fetch('/api/admin/settings');
                        const result = await response.json();
                        if (result.success) {
                            this.settings = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                    }
                },
                showAddEmployeeDialog() {
                    this.editingEmployee = { name: '', department: '', active: true };
                    this.employeeDialogVisible = true;
                },
                showAddRestaurantDialog() {
                    this.editingRestaurant = { 
                        name: '', 
                        description: '', 
                        phone: '', 
                        address: '', 
                        availableDays: [1, 2, 3, 4, 5], 
                        active: true 
                    };
                    this.restaurantDialogVisible = true;
                },
                showAddDishDialog() {
                    this.editingDish = { 
                        name: '', 
                        description: '', 
                        category: 'è¤èœ', 
                        restaurantId: null, 
                        price: 0, 
                        active: true 
                    };
                    this.dishDialogVisible = true;
                },
                editEmployee(employee) {
                    this.editingEmployee = { ...employee };
                    this.employeeDialogVisible = true;
                },
                editRestaurant(restaurant) {
                    this.editingRestaurant = { ...restaurant };
                    this.restaurantDialogVisible = true;
                },
                editDish(dish) {
                    this.editingDish = { ...dish };
                    this.dishDialogVisible = true;
                },
                async saveEmployee() {
                    try {
                        const method = this.editingEmployee.id ? 'PUT' : 'POST';
                        const url = this.editingEmployee.id ? 
                            `/api/admin/employees/${this.editingEmployee.id}` : 
                            '/api/admin/employees';
                        
                        const response = await fetch(url, {
                            method,
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.editingEmployee)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('ä¿å­˜æˆåŠŸ');
                            this.employeeDialogVisible = false;
                            this.loadEmployees();
                        } else {
                            ElMessage.error(result.message || 'ä¿å­˜å¤±è´¥');
                        }
                    } catch (error) {
                        ElMessage.error('ä¿å­˜å¤±è´¥');
                        console.error('ä¿å­˜å‘˜å·¥å¤±è´¥:', error);
                    }
                },
                async saveRestaurant() {
                    try {
                        const method = this.editingRestaurant.id ? 'PUT' : 'POST';
                        const url = this.editingRestaurant.id ? 
                            `/api/admin/restaurants/${this.editingRestaurant.id}` : 
                            '/api/admin/restaurants';
                        
                        const response = await fetch(url, {
                            method,
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.editingRestaurant)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('ä¿å­˜æˆåŠŸ');
                            this.restaurantDialogVisible = false;
                            this.loadRestaurants();
                        } else {
                            ElMessage.error(result.message || 'ä¿å­˜å¤±è´¥');
                        }
                    } catch (error) {
                        ElMessage.error('ä¿å­˜å¤±è´¥');
                        console.error('ä¿å­˜é¥­åº—å¤±è´¥:', error);
                    }
                },
                async saveDish() {
                    try {
                        const method = this.editingDish.id ? 'PUT' : 'POST';
                        const url = this.editingDish.id ? 
                            `/api/admin/dishes/${this.editingDish.id}` : 
                            '/api/admin/dishes';
                        
                        const response = await fetch(url, {
                            method,
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.editingDish)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('ä¿å­˜æˆåŠŸ');
                            this.dishDialogVisible = false;
                            this.loadDishes();
                        } else {
                            ElMessage.error(result.message || 'ä¿å­˜å¤±è´¥');
                        }
                    } catch (error) {
                        ElMessage.error('ä¿å­˜å¤±è´¥');
                        console.error('ä¿å­˜èœå“å¤±è´¥:', error);
                    }
                },
                async deleteEmployee(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šåˆ é™¤æ­¤å‘˜å·¥å—ï¼Ÿ', 'æç¤º', {
                            confirmButtonText: 'ç¡®å®š',
                            cancelButtonText: 'å–æ¶ˆ',
                            type: 'warning'
                        });
                        
                        const response = await fetch(`/api/admin/employees/${id}`, {
                            method: 'DELETE'
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('åˆ é™¤æˆåŠŸ');
                            this.loadEmployees();
                        } else {
                            ElMessage.error(result.message || 'åˆ é™¤å¤±è´¥');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error('åˆ é™¤å¤±è´¥');
                            console.error('åˆ é™¤å‘˜å·¥å¤±è´¥:', error);
                        }
                    }
                },
                async deleteRestaurant(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šåˆ é™¤æ­¤é¥­åº—å—ï¼Ÿ', 'æç¤º', {
                            confirmButtonText: 'ç¡®å®š',
                            cancelButtonText: 'å–æ¶ˆ',
                            type: 'warning'
                        });
                        
                        const response = await fetch(`/api/admin/restaurants/${id}`, {
                            method: 'DELETE'
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('åˆ é™¤æˆåŠŸ');
                            this.loadRestaurants();
                        } else {
                            ElMessage.error(result.message || 'åˆ é™¤å¤±è´¥');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error('åˆ é™¤å¤±è´¥');
                            console.error('åˆ é™¤é¥­åº—å¤±è´¥:', error);
                        }
                    }
                },
                async deleteDish(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šåˆ é™¤æ­¤èœå“å—ï¼Ÿ', 'æç¤º', {
                            confirmButtonText: 'ç¡®å®š',
                            cancelButtonText: 'å–æ¶ˆ',
                            type: 'warning'
                        });
                        
                        const response = await fetch(`/api/admin/dishes/${id}`, {
                            method: 'DELETE'
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('åˆ é™¤æˆåŠŸ');
                            this.loadDishes();
                        } else {
                            ElMessage.error(result.message || 'åˆ é™¤å¤±è´¥');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error('åˆ é™¤å¤±è´¥');
                            console.error('åˆ é™¤èœå“å¤±è´¥:', error);
                        }
                    }
                },
                async saveSettings() {
                    try {
                        const response = await fetch('/api/admin/settings', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.settings)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('è®¾ç½®ä¿å­˜æˆåŠŸ');
                        } else {
                            ElMessage.error(result.message || 'ä¿å­˜å¤±è´¥');
                        }
                    } catch (error) {
                        ElMessage.error('ä¿å­˜å¤±è´¥');
                        console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', error);
                    }
                },
                async generateMenu() {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šé‡æ–°ç”Ÿæˆæœ¬å‘¨èœå•å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰èœå•ã€‚', 'æç¤º', {
                            confirmButtonText: 'ç¡®å®š',
                            cancelButtonText: 'å–æ¶ˆ',
                            type: 'warning'
                        });
                        
                        const response = await fetch('/api/admin/menu/generate', {
                            method: 'POST'
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('èœå•ç”ŸæˆæˆåŠŸ');
                        } else {
                            ElMessage.error(result.message || 'ç”Ÿæˆå¤±è´¥');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error('ç”Ÿæˆå¤±è´¥');
                            console.error('ç”Ÿæˆèœå•å¤±è´¥:', error);
                        }
                    }
                },
                async exportData(type) {
                    try {
                        const response = await fetch(`/api/admin/export/${type}`);
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${type}-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ');
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥');
                        console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                    }
                },
                async exportAllData() {
                    try {
                        const response = await fetch('/api/admin/export/all');
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `order-system-data-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ');
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥');
                        console.error('å¯¼å‡ºæ•°æ®å¤±è´¥:', error);
                    }
                },
                getRestaurantName(restaurantId) {
                    const restaurant = this.restaurants.find(r => r.id === restaurantId);
                    return restaurant ? restaurant.name : 'æœªçŸ¥é¥­åº—';
                },
                getDayNameByNum(dayNum) {
                    const days = ['', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”'];
                    return days[dayNum] || dayNum;
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>