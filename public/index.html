<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÖ¨Âè∏ËÆ¢È§êÁ≥ªÁªü</title>
    <link href="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.css" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .date-info {
            margin-top: 10px;
        }
        .date-info h2 {
            margin: 0;
            font-size: 24px;
            font-weight: normal;
        }
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .meal-section {
            margin-bottom: 30px;
        }
        .meal-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }
        .meal-title .icon {
            margin-right: 10px;
            font-size: 24px;
        }
        .dish-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        .dish-card {
            border: 1px solid #ebeef5;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .dish-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
            border-color: #409eff;
        }
        .dish-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .dish-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }
        .dish-rating {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #f56c6c;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        .register-form {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        .actions-bar {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        .stats-section {
            margin-bottom: 30px;
        }
        .quick-actions {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .quick-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 10px;
        }
        .menu-actions {
            text-align: center;
            margin: 30px 0;
        }
        .admin-section {
            margin-top: 30px;
        }
        /* ËèúÂçïÈ°µÊ†∑Âºè */
        .menu-week-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        .menu-day-card {
            border: 1px solid #e4e7ed;
            border-radius: 12px;
            padding: 25px;
            background: white;
        }
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f2f5;
            padding-bottom: 10px;
        }
        .day-header h3 {
            margin: 0;
            color: #333;
            font-size: 20px;
        }
        .day-date {
            color: #666;
            font-size: 14px;
        }
        .meal-header {
            display: flex;
            align-items: center;
            margin: 20px 0 15px 0;
            font-size: 16px;
            font-weight: bold;
        }
        .meal-icon {
            margin-right: 8px;
            font-size: 18px;
        }
        .meal-title {
            color: #333;
        }
        .restaurant-group {
            margin-bottom: 25px;
        }
        .restaurant-name {
            font-size: 14px;
            font-weight: bold;
            color: #409eff;
            margin-bottom: 10px;
            padding: 5px 10px;
            background: #f0f8ff;
            border-radius: 6px;
            display: inline-block;
        }
        .dishes-list {
            margin-left: 20px;
        }
        .dish-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 5px;
            border: 1px solid #f0f0f0;
            border-radius: 6px;
            transition: all 0.3s;
        }
        .dish-item:hover {
            background-color: #f8f9fa;
            border-color: #409eff;
        }
        .dish-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        .dish-rating {
            font-size: 12px;
            color: #f56c6c;
        }
        .no-menu {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 40px;
        }
        @media (max-width: 768px) {
            .dishes-list {
                margin-left: 0;
            }
        }
        .rating-section {
            background: #fff7f0;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        /* ‰ªäÊó•ËèúÂçïÈ¢ÑËßàÊ†∑Âºè */
        .today-menu-section {
            background: #f8fff8;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e8f5e8;
        }
        .restaurant-preview {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e4f4e4;
        }
        .restaurant-name-preview {
            font-size: 14px;
            font-weight: bold;
            color: #409eff;
            margin-bottom: 8px;
            display: inline-block;
            background: #f0f8ff;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .dishes-preview {
            font-size: 13px;
            color: #333;
            line-height: 1.6;
        }
        .dish-preview {
            margin-right: 5px;
        }
        .rating-preview {
            font-size: 11px;
            color: #f56c6c;
            margin-left: 2px;
        }
        @media (max-width: 768px) {
            .dish-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
            .main-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>üçΩÔ∏è ÂÖ¨Âè∏ËÆ¢È§êÁ≥ªÁªü</h1>
                <div class="date-info">
                    <h2>{{ formattedTodayDate }} {{ getDayName() }}</h2>
                </div>
            </div>

            <!-- ËèúÂçïÈ°µ -->
            <div class="main-card" v-if="currentPage === 'menu'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>üìã Êú¨Âë®ËèúÂçï</h2>
                    <div>
                        <el-button type="success" @click="syncExcelData" :loading="syncLoading">
                            üìÑ ‰ªéExcelÂêåÊ≠•ËèúÂçï
                        </el-button>
                        <el-button type="primary" @click="backToHome">ËøîÂõûÈ¶ñÈ°µ</el-button>
                    </div>
                </div>
                
                <!-- ExcelÊñá‰ª∂Áä∂ÊÄÅ‰ø°ÊÅØ -->
                <div v-if="excelStatus" class="excel-status" style="margin-bottom: 20px;">
                    <el-alert 
                        :title="excelStatus.exists ? 'ExcelÊñá‰ª∂Â∑≤Â∞±Áª™' : 'ExcelÊñá‰ª∂Êú™ÊâæÂà∞'"
                        :type="excelStatus.exists ? 'success' : 'warning'"
                        :description="excelStatus.exists ? `Êñá‰ª∂Ë∑ØÂæÑ: ${excelStatus.path}` : `ËØ∑Â∞Ü ËèúÂçïÁÆ°ÁêÜ.csv Êñá‰ª∂ÊîæÁΩÆÂú®È°πÁõÆÊ†πÁõÆÂΩï‰∏ã`"
                        show-icon>
                    </el-alert>
                </div>
                
                <div class="menu-week-container">
                    <div class="menu-day-card" v-for="(dayMenu, day) in weekMenus" :key="day" v-show="day !== 6">
                        <div class="day-header">
                            <h3>{{ getDayNameByNum(day) }}</h3>
                            <div class="day-date">{{ getDateByWeekday(day) }}</div>
                        </div>
                        
                        <!-- ÂçàÈ§êËèúÂçï -->
                        <div class="meal-section" v-if="dayMenu.lunch && dayMenu.lunch.length > 0">
                            <div class="meal-header">
                                <span class="meal-icon">üåÖ</span>
                                <span class="meal-title">ÂçàÈ§ê</span>
                            </div>
                            <div class="restaurant-group" v-for="restaurant in groupByRestaurant(dayMenu.lunch)" :key="restaurant.name">
                                <div class="restaurant-name">{{ restaurant.name }}</div>
                                <div class="dishes-list">
                                    <div class="dish-item" v-for="dish in restaurant.dishes" :key="dish.id">
                                        <div class="dish-name">{{ dish.dishName }}</div>
                                        <div class="dish-rating">‚≠ê {{ dish.rating ? dish.rating.toFixed(1) : '--' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÊôöÈ§êËèúÂçï -->
                        <div class="meal-section" v-if="dayMenu.dinner && dayMenu.dinner.length > 0">
                            <div class="meal-header">
                                <span class="meal-icon">üåô</span>
                                <span class="meal-title">ÊôöÈ§ê</span>
                            </div>
                            <div class="restaurant-group" v-for="restaurant in groupByRestaurant(dayMenu.dinner)" :key="restaurant.name">
                                <div class="restaurant-name">{{ restaurant.name }}</div>
                                <div class="dishes-list">
                                    <div class="dish-item" v-for="dish in restaurant.dishes" :key="dish.id">
                                        <div class="dish-name">{{ dish.dishName }}</div>
                                        <div class="dish-rating">‚≠ê {{ dish.rating ? dish.rating.toFixed(1) : '--' }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Êó†ËèúÂçïÊèêÁ§∫ -->
                        <div v-if="(!dayMenu.lunch || dayMenu.lunch.length === 0) && (!dayMenu.dinner || dayMenu.dinner.length === 0)" 
                             class="no-menu">
                            ÊöÇÊó†ËèúÂçï
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÁÇπËØÑÈ°µÈù¢ -->
            <div class="main-card" v-if="currentPage === 'rating'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>‚≠ê ËèúÂìÅÁÇπËØÑ</h2>
                    <el-button type="primary" @click="backToHome">ËøîÂõûÈ¶ñÈ°µ</el-button>
                </div>


                <!-- ‰ªäÊó•ËèúÂçïËØÑ‰ª∑Âå∫Âüü -->
                <div v-if="todayMenuForRating && ((todayMenuForRating.lunch && todayMenuForRating.lunch.length > 0) || (todayMenuForRating.dinner && todayMenuForRating.dinner.length > 0))">
                    <!-- ÂçàÈ§êËØÑ‰ª∑ -->
                    <div class="meal-section" v-if="todayMenuForRating.lunch && todayMenuForRating.lunch.length > 0">
                        <div class="meal-title">
                            <span class="icon">üåÖ</span>
                            ÂçàÈ§êËØÑ‰ª∑
                        </div>
                        <div class="dish-grid">
                            <div class="dish-card" 
                                 v-for="dish in todayMenuForRating.lunch" 
                                 :key="dish.dishId"
                                 @click="openRatingDialog(dish, 'lunch')"
                                 style="cursor: pointer;">
                                <div class="dish-name">{{ dish.dishName }}</div>
                                <div class="dish-desc">{{ dish.restaurantName }}</div>
                                <div class="dish-rating">
                                    <span v-if="dish.rating">‚≠ê {{ dish.rating.toFixed(1) }}</span>
                                    <span v-else>ÊöÇÊó†ËØÑÂàÜ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊôöÈ§êËØÑ‰ª∑ -->
                    <div class="meal-section" v-if="todayMenuForRating.dinner && todayMenuForRating.dinner.length > 0">
                        <div class="meal-title">
                            <span class="icon">üåô</span>
                            ÊôöÈ§êËØÑ‰ª∑
                        </div>
                        <div class="dish-grid">
                            <div class="dish-card" 
                                 v-for="dish in todayMenuForRating.dinner" 
                                 :key="dish.dishId"
                                 @click="openRatingDialog(dish, 'dinner')"
                                 style="cursor: pointer;">
                                <div class="dish-name">{{ dish.dishName }}</div>
                                <div class="dish-desc">{{ dish.restaurantName }}</div>
                                <div class="dish-rating">
                                    <span v-if="dish.rating">‚≠ê {{ dish.rating.toFixed(1) }}</span>
                                    <span v-else>ÊöÇÊó†ËØÑÂàÜ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êó†ËèúÂçïÊèêÁ§∫ -->
                <div v-else class="no-menu">
                    ‰ªäÊó•ÊöÇÊó†ËèúÂçïÂèØËØÑ‰ª∑
                </div>

                <!-- ËØÑ‰ª∑ÂØπËØùÊ°Ü -->
                <el-dialog v-model="showRatingDialog" title="ËèúÂìÅËØÑ‰ª∑" width="500px" center>
                    <div v-if="selectedRatingDish && selectedRatingDish.dishName">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3>{{ selectedRatingDish.dishName }}</h3>
                            <p style="color: #666;">{{ selectedRatingDish.restaurantName }}</p>
                        </div>

                        <el-form :model="ratingForm" label-width="80px">
                            <el-form-item label="ÊÇ®ÁöÑÂßìÂêç" required>
                                <el-input 
                                    v-model="ratingForm.employeeName" 
                                    placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç"
                                    :disabled="ratingSubmitting">
                                </el-input>
                            </el-form-item>
                            
                            <el-form-item label="ËèúÂìÅËØÑÂàÜ" required>
                                <el-rate 
                                    v-model="ratingForm.rating" 
                                    :max="5" 
                                    show-score
                                    score-template="ËØÑÂàÜ: {value}"
                                    :disabled="ratingSubmitting">
                                </el-rate>
                            </el-form-item>
                            
                            <el-form-item label="ÊñáÂ≠óÂª∫ËÆÆ">
                                <el-input 
                                    v-model="ratingForm.comment"
                                    type="textarea"
                                    :rows="3"
                                    placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂª∫ËÆÆ"
                                    maxlength="200"
                                    show-word-limit
                                    :disabled="ratingSubmitting">
                                </el-input>
                            </el-form-item>
                        </el-form>
                    </div>
                    
                    <template #footer>
                        <span class="dialog-footer">
                            <el-button @click="closeRatingDialog" :disabled="ratingSubmitting">ÂèñÊ∂à</el-button>
                            <el-button type="primary" @click="submitRating" :loading="ratingSubmitting">
                                Êèê‰∫§ËØÑ‰ª∑
                            </el-button>
                        </span>
                    </template>
                </el-dialog>
            </div>

            <!-- È¶ñÈ°µ -->
            <div class="main-card" v-if="currentPage === 'home'">
                <!-- ËÆ¢È§êÁªüËÆ°Âç°Áâá - ÊîæÂú®ÊúÄ‰∏äÊñπ -->
                <div class="stats-section">
                    <h3 style="margin-bottom: 20px; color: #333;">üìä ‰ªäÊó•ËÆ¢È§êÁªüËÆ°</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">{{ orderStats.lunch.orderCount }}</div>
                            <div class="stat-label">ÂçàÈ§êËÆ¢È§ê‰ªΩÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ orderStats.lunch.noEatCount }}</div>
                            <div class="stat-label">ÂçàÈ§ê‰∏çÂêÉ‰∫∫Êï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ orderStats.dinner.orderCount }}</div>
                            <div class="stat-label">ÊôöÈ§êËÆ¢È§ê‰ªΩÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ orderStats.dinner.noEatCount }}</div>
                            <div class="stat-label">ÊôöÈ§ê‰∏çÂêÉ‰∫∫Êï∞</div>
                        </div>
                    </div>
                </div>

                <!-- Âø´Êç∑ÊåâÈíÆ -->
                <div class="quick-actions">
                    <h3 style="margin-bottom: 20px; color: #333;">‚ö° Âø´Êç∑Êìç‰Ωú</h3>
                    <div class="quick-buttons">
                        <el-button type="warning" size="large" @click="registerNoEat('lunch')" 
                                   :disabled="!isWorkday">
                            ü•ó Êàë‰∏≠Âçà‰∏çÂêÉ
                        </el-button>
                        <el-button type="info" size="large" @click="registerNoEat('dinner')" 
                                   :disabled="!isWorkday">
                            üåô ÊàëÊôö‰∏ä‰∏çÂêÉ
                        </el-button>
                    </div>
                </div>

                <!-- ‰ªäÊó•ËèúÂçïÈ¢ÑËßà -->
                <div v-if="isWorkday && (todayMenu.lunch.length > 0 || todayMenu.dinner.length > 0)" class="today-menu-section">
                    <h3 style="margin-bottom: 20px; color: #333;">üçΩÔ∏è ‰ªäÊó•ËèúÂçï</h3>
                    
                    <!-- ÂçàÈ§êËèúÂçï -->
                    <div v-if="todayMenu.lunch.length > 0" class="meal-section">
                        <div class="meal-title">
                            <span class="icon">üåÖ</span>
                            ÂçàÈ§ê
                        </div>
                        <div class="restaurant-preview" v-for="restaurant in groupByRestaurant(todayMenu.lunch)" :key="restaurant.name">
                            <div class="restaurant-name-preview">{{ restaurant.name }}</div>
                            <div class="dishes-preview">
                                <span v-for="(dish, index) in restaurant.dishes" :key="dish.dishId" class="dish-preview">
                                    {{ dish.dishName }}<span v-if="dish.rating" class="rating-preview">‚≠ê{{ dish.rating.toFixed(1) }}</span><span v-if="index < restaurant.dishes.length - 1">„ÄÅ</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- ÊôöÈ§êËèúÂçï -->
                    <div v-if="todayMenu.dinner.length > 0" class="meal-section">
                        <div class="meal-title">
                            <span class="icon">üåô</span>
                            ÊôöÈ§ê
                        </div>
                        <div class="restaurant-preview" v-for="restaurant in groupByRestaurant(todayMenu.dinner)" :key="restaurant.name">
                            <div class="restaurant-name-preview">{{ restaurant.name }}</div>
                            <div class="dishes-preview">
                                <span v-for="(dish, index) in restaurant.dishes" :key="dish.dishId" class="dish-preview">
                                    {{ dish.dishName }}<span v-if="dish.rating" class="rating-preview">‚≠ê{{ dish.rating.toFixed(1) }}</span><span v-if="index < restaurant.dishes.length - 1">„ÄÅ</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êü•ÁúãÊú¨Âë®ËèúÂçïÊåâÈíÆ -->
                <div class="menu-actions">
                    <el-button type="primary" size="large" @click="showMenuPage">
                        üìã Êü•ÁúãÊú¨Âë®ËèúÂçï
                    </el-button>
                    <el-button type="success" size="large" @click="showRatingPage">
                        ‚≠ê ÁÇπËØÑËèúÂìÅ
                    </el-button>
                </div>

                <!-- Âë®Êú´ÊèêÁ§∫ -->
                <div v-if="!isWorkday" style="text-align: center; padding: 50px; color: #666;">
                    <h3>üéâ ‰ªäÂ§©ÊòØ‰ºëÊÅØÊó•ÔºåÊöÇÊó†ËèúÂçï</h3>
                    <p>Âë®‰∏ÄÂà∞Âë®‰∫îÊâçÊúâËÆ¢È§êÊúçÂä°Âì¶</p>
                </div>

                <!-- ÁÆ°ÁêÜÂëòÂäüËÉΩÂå∫Âüü -->
                <div class="admin-section" v-if="showAdminFeatures">
                    <el-divider>ÁÆ°ÁêÜÂëòÂäüËÉΩ</el-divider>
                    
                    <!-- ÂΩìÂâç‰∫∫Êï∞ËÆæÁΩÆ -->
                    <div class="register-form">
                        <h3 style="margin-top: 0;">üë• ÂΩìÂâç‰∫∫Êï∞ËÆæÁΩÆ</h3>
                        <el-form :model="currentPeopleForm" inline>
                            <el-form-item label="ÂΩìÂâç‰∫∫Êï∞">
                                <el-input-number 
                                    v-model="currentPeopleForm.count" 
                                    :min="0" 
                                    :max="200" 
                                    placeholder="ËæìÂÖ•ÂΩìÂâç‰∫∫Êï∞"
                                    style="width: 150px;">
                                </el-input-number>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="setCurrentPeople">ËÆæÁΩÆ‰∫∫Êï∞</el-button>
                            </el-form-item>
                        </el-form>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            <div>ÂΩìÂâç‰∫∫Êï∞: {{ currentPeople.total }} ‰∫∫</div>
                        </div>
                    </div>

                    <!-- ‰∏çÂêÉÈ•≠‰∫∫Êï∞ÁÆ°ÁêÜ -->
                    <div class="register-form" style="margin-top: 20px;">
                        <h3 style="margin-top: 0;">üßπ ‰∏çÂêÉÈ•≠‰∫∫Êï∞ÁÆ°ÁêÜ</h3>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <el-button type="warning" @click="clearNoEatCount('lunch')" :loading="clearingLunch">
                                Ê∏ÖÈõ∂ÂçàÈ§ê‰∏çÂêÉ‰∫∫Êï∞
                            </el-button>
                            <el-button type="info" @click="clearNoEatCount('dinner')" :loading="clearingDinner">
                                Ê∏ÖÈõ∂ÊôöÈ§ê‰∏çÂêÉ‰∫∫Êï∞
                            </el-button>
                        </div>
                        <div style="margin-top: 15px; text-align: center; font-size: 14px; color: #666;">
                            ÂΩìÂâç‰∏çÂêÉ‰∫∫Êï∞ - ÂçàÈ§ê: {{ orderStats.lunch.noEatCount }} ‰∫∫ÔºåÊôöÈ§ê: {{ orderStats.dinner.noEatCount }} ‰∫∫
                        </div>
                    </div>
                </div>

                <!-- ÂÖ∂‰ªñÊìç‰Ωú -->
                <div class="actions-bar">
                    <el-button type="success" @click="refreshData">üîÑ Âà∑Êñ∞Êï∞ÊçÆ</el-button>
                    <el-button type="primary" @click="toggleAdminFeatures">
                        {{ showAdminFeatures ? 'ÈöêËóè' : 'ÊòæÁ§∫' }}ÁÆ°ÁêÜÂëòÂäüËÉΩ
                    </el-button>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.8/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.full.js"></script>
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    currentPage: 'home', // 'home', 'menu', or 'rating'
                    todayDate: new Date().toLocaleDateString('zh-CN'),
                    formattedTodayDate: this.formatTodayDate(),
                    todayMenu: {
                        lunch: [],
                        dinner: []
                    },
                    todayMenuForRating: {
                        lunch: [],
                        dinner: []
                    },
                    orderStats: {
                        lunch: { orderCount: 0, noEatCount: 0, status: 'closed' },
                        dinner: { orderCount: 0, noEatCount: 0, status: 'closed' }
                    },
                    currentPeopleForm: {
                        count: 0
                    },
                    currentPeople: {
                        total: 0
                    },
                    ratingForm: {
                        employeeName: '',
                        dishId: null,
                        rating: 5,
                        comment: '',
                        mealType: 'lunch'
                    },
                    selectedDish: {},
                    showRatingForm: false,
                    showRatingDialog: false,
                    selectedRatingDish: {},
                    ratingSubmitting: false,
                    weekMenus: {},
                    showAdminFeatures: false,
                    syncLoading: false,
                    excelStatus: null,
                    clearingLunch: false,
                    clearingDinner: false
                };
            },
            computed: {
                isWorkday() {
                    const today = new Date().getDay();
                    return today !== 6; // Èô§‰∫ÜÂë®ÂÖ≠ÈÉΩÊòØÂ∑•‰ΩúÊó•ÔºàÂë®Êó•=0, Âë®‰∏Ä=1...Âë®‰∫î=5, Âë®ÂÖ≠=6Ôºâ
                }
            },
            mounted() {
                this.loadTodayMenu();
                this.loadOrderStats();
                this.loadCurrentPeople();
                // ÊØè30ÁßíÂà∑Êñ∞ÁªüËÆ°Êï∞ÊçÆ
                setInterval(() => {
                    this.loadOrderStats();
                    this.loadCurrentPeople();
                }, 30000);
            },
            methods: {
                async loadTodayMenu() {
                    try {
                        const response = await fetch('/api/menu/today');
                        const result = await response.json();
                        if (result.success) {
                            this.todayMenu = result.data;
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩ‰ªäÊó•ËèúÂçïÂ§±Ë¥•:', error);
                    }
                },
                async loadOrderStats() {
                    try {
                        const response = await fetch('/api/order/stats/today');
                        const result = await response.json();
                        if (result.success) {
                            this.orderStats = result.data;
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩËÆ¢È§êÁªüËÆ°Â§±Ë¥•:', error);
                    }
                },
                async loadCurrentPeople() {
                    try {
                        const response = await fetch('/api/current-people/today');
                        const result = await response.json();
                        if (result.success) {
                            this.currentPeople = result.data;
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩÂΩìÂâç‰∫∫Êï∞Â§±Ë¥•:', error);
                    }
                },
                async setCurrentPeople() {
                    if (this.currentPeopleForm.count === undefined || this.currentPeopleForm.count < 0) {
                        ElMessage.warning('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ‰∫∫Êï∞');
                        return;
                    }

                    try {
                        const response = await fetch('/api/current-people/set', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                currentPeople: this.currentPeopleForm.count
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('ËÆæÁΩÆÊàêÂäü');
                            this.currentPeopleForm.count = 0;
                            this.loadOrderStats();
                            this.loadCurrentPeople();
                        } else {
                            ElMessage.error(result.message || 'ËÆæÁΩÆÂ§±Ë¥•');
                        }
                    } catch (error) {
                        ElMessage.error('ËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        console.error('ËÆæÁΩÆÂ§±Ë¥•:', error);
                    }
                },
                selectDishForRating(dish, mealType) {
                    this.selectedDish = dish;
                    this.ratingForm.dishId = dish.dishId;
                    this.ratingForm.mealType = mealType;
                    this.showRatingForm = true;
                },
                async submitRating() {
                    console.log('ÂºÄÂßãÊèê‰∫§ËØÑ‰ª∑', this.ratingForm);
                    if (!this.ratingForm.employeeName) {
                        ElMessage.warning('ËØ∑ËæìÂÖ•ÂßìÂêç');
                        return;
                    }

                    if (!this.ratingForm.rating || this.ratingForm.rating < 1 || this.ratingForm.rating > 5) {
                        ElMessage.warning('ËØ∑ÈÄâÊã©1-5ÊòüËØÑÂàÜ');
                        return;
                    }

                    this.ratingSubmitting = true;
                    console.log('ÂºÄÂßãÂèëÈÄÅËØ∑Ê±ÇÂà∞ÊúçÂä°Âô®');

                    try {
                        const response = await fetch('/api/rating/submit', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.ratingForm)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success('ËØÑ‰ª∑Êèê‰∫§ÊàêÂäüÔºÅÊÑüË∞¢ÊÇ®ÁöÑÂèçÈ¶à');
                            this.closeRatingDialog();
                            // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ‰ª•ÊòæÁ§∫Êñ∞ÁöÑËØÑÂàÜ
                            await this.loadRatingPageMenu();
                        } else {
                            ElMessage.error(result.message || 'ËØÑ‰ª∑Êèê‰∫§Â§±Ë¥•');
                            this.ratingSubmitting = false;
                        }
                    } catch (error) {
                        ElMessage.error('ËØÑ‰ª∑Êèê‰∫§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        console.error('ËØÑ‰ª∑Êèê‰∫§Â§±Ë¥•:', error);
                        this.ratingSubmitting = false;
                    }
                },
                async loadRatingPageMenu() {
                    try {
                        const response = await fetch('/api/menu/today');
                        const result = await response.json();
                        if (result.success) {
                            this.todayMenuForRating = result.data;
                        }
                    } catch (error) {
                        console.error('Âà∑Êñ∞ËèúÂçïÂ§±Ë¥•:', error);
                    }
                },
                closeRatingForm() {
                    this.showRatingForm = false;
                    this.ratingForm = {
                        employeeName: '',
                        dishId: null,
                        rating: 5,
                        comment: '',
                        mealType: 'lunch'
                    };
                    this.selectedDish = {};
                },
                async showMenuPage() {
                    try {
                        // Âä†ËΩΩËèúÂçïÊï∞ÊçÆ
                        const response = await fetch('/api/menu/week');
                        const result = await response.json();
                        if (result.success) {
                            this.weekMenus = result.data;
                            this.currentPage = 'menu';
                            // Ê£ÄÊü•ExcelÊñá‰ª∂Áä∂ÊÄÅ
                            await this.checkExcelStatus();
                        }
                    } catch (error) {
                        ElMessage.error('Âä†ËΩΩÂë®ËèúÂçïÂ§±Ë¥•');
                        console.error('Âä†ËΩΩÂë®ËèúÂçïÂ§±Ë¥•:', error);
                    }
                },
                async checkExcelStatus() {
                    try {
                        const response = await fetch('/api/excel/status');
                        const result = await response.json();
                        if (result.success) {
                            this.excelStatus = result.data;
                        }
                    } catch (error) {
                        console.error('Ê£ÄÊü•ExcelÁä∂ÊÄÅÂ§±Ë¥•:', error);
                    }
                },
                async syncExcelData() {
                    if (this.syncLoading) return;
                    
                    this.syncLoading = true;
                    try {
                        const response = await fetch('/api/excel/sync', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            ElMessage.success(result.message);
                            // ÈáçÊñ∞Âä†ËΩΩËèúÂçïÊï∞ÊçÆ
                            await this.loadWeekMenus();
                            // Êõ¥Êñ∞ExcelÁä∂ÊÄÅ
                            await this.checkExcelStatus();
                        } else {
                            ElMessage.error(result.message || 'ExcelÂêåÊ≠•Â§±Ë¥•');
                        }
                    } catch (error) {
                        ElMessage.error('ExcelÂêåÊ≠•Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        console.error('ExcelÂêåÊ≠•Â§±Ë¥•:', error);
                    } finally {
                        this.syncLoading = false;
                    }
                },
                async loadWeekMenus() {
                    try {
                        const response = await fetch('/api/menu/week');
                        const result = await response.json();
                        if (result.success) {
                            this.weekMenus = result.data;
                        }
                    } catch (error) {
                        console.error('ÈáçÊñ∞Âä†ËΩΩËèúÂçïÂ§±Ë¥•:', error);
                    }
                },
                backToHome() {
                    this.currentPage = 'home';
                },
                async showRatingPage() {
                    try {
                        console.log('ÂºÄÂßãÂä†ËΩΩÁÇπËØÑÈ°µÈù¢');
                        const response = await fetch('/api/menu/today');
                        const result = await response.json();
                        console.log('ËèúÂçïAPIËøîÂõûÊï∞ÊçÆ:', result);
                        if (result.success) {
                            this.todayMenuForRating = result.data;
                            this.currentPage = 'rating';
                            console.log('ÁÇπËØÑÈ°µÈù¢Êï∞ÊçÆÂ∑≤ËÆæÁΩÆ:', this.todayMenuForRating);
                            console.log('ÂΩìÂâçÈ°µÈù¢Áä∂ÊÄÅ:', this.currentPage);
                        }
                    } catch (error) {
                        ElMessage.error('Âä†ËΩΩ‰ªäÊó•ËèúÂçïÂ§±Ë¥•');
                        console.error('Âä†ËΩΩ‰ªäÊó•ËèúÂçïÂ§±Ë¥•:', error);
                    }
                },
                openRatingDialog(dish, mealType) {
                    console.log('ÂºÄÂßãÊâìÂºÄËØÑ‰ª∑ÂØπËØùÊ°Ü', dish, mealType);
                    this.selectedRatingDish = dish;
                    this.ratingForm = {
                        employeeName: '',
                        dishId: dish.dishId,
                        rating: 5,
                        comment: '',
                        mealType: mealType
                    };
                    this.showRatingDialog = true;
                    console.log('ÂØπËØùÊ°ÜÁä∂ÊÄÅÂ∑≤ËÆæÁΩÆ‰∏∫true', this.showRatingDialog);
                },
                closeRatingDialog() {
                    this.showRatingDialog = false;
                    this.selectedRatingDish = {};
                    this.ratingForm = {
                        employeeName: '',
                        dishId: null,
                        rating: 5,
                        comment: '',
                        mealType: 'lunch'
                    };
                    this.ratingSubmitting = false;
                },
                groupByRestaurant(dishes) {
                    const groups = {};
                    dishes.forEach(dish => {
                        const restaurantName = dish.restaurantName || 'Êú™Áü•È§êÂéÖ';
                        if (!groups[restaurantName]) {
                            groups[restaurantName] = {
                                name: restaurantName,
                                dishes: []
                            };
                        }
                        groups[restaurantName].dishes.push(dish);
                    });
                    return Object.values(groups);
                },
                getDateByWeekday(dayNum) {
                    const today = new Date();
                    const currentDayOfWeek = today.getDay(); // 0=Âë®Êó•, 1=Âë®‰∏Ä...6=Âë®ÂÖ≠
                    
                    // ËÆ°ÁÆóÊú¨Âë®ÁöÑÁõÆÊ†áÊó•Êúü
                    const targetDate = new Date(today);
                    let offset = dayNum - currentDayOfWeek;
                    
                    // ÁâπÊÆäÂ§ÑÁêÜÂë®Êó•ÔºöÂ¶ÇÊûú‰ªäÂ§©‰∏çÊòØÂë®Êó•ÔºåÂë®Êó•Â∫îËØ•ÊòØÊú¨Âë®ÁöÑÊúÄÂêé‰∏ÄÂ§©
                    if (dayNum === 0 && currentDayOfWeek !== 0) {
                        offset = 7 - currentDayOfWeek; // Âà∞Êú¨Âë®Êó•ÁöÑÂ§©Êï∞
                    }
                    
                    targetDate.setDate(today.getDate() + offset);
                    
                    return targetDate.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                },
                handleImageError(event) {
                    event.target.src = '/images/default-dish.jpg';
                },
                async registerNoEat(mealType) {
                    try {
                        // Á°Æ‰øùÊó•ÊúüÊ†ºÂºè‰∏éÂêéÁ´Ø‰∏ÄËá¥
                        const today = new Date();
                        const dateStr = today.getFullYear() + '-' + 
                                       String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                       String(today.getDate()).padStart(2, '0');
                        
                        console.log('Ê≥®ÂÜå‰∏çÂêÉ:', { mealType, date: dateStr });
                        
                        const response = await fetch('/api/no-eat/register', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                mealType: mealType,
                                date: dateStr
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            ElMessage.success(`Â∑≤ËÆ∞ÂΩï${mealType === 'lunch' ? '‰∏≠Âçà' : 'Êôö‰∏ä'}‰∏çÂêÉ`);
                            this.loadOrderStats();
                        } else {
                            ElMessage.error(result.message || 'ËÆ∞ÂΩïÂ§±Ë¥•');
                        }
                    } catch (error) {
                        ElMessage.error('ËÆ∞ÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        console.error('ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                    }
                },
                toggleAdminFeatures() {
                    this.showAdminFeatures = !this.showAdminFeatures;
                },
                async clearNoEatCount(mealType) {
                    const mealName = mealType === 'lunch' ? 'ÂçàÈ§ê' : 'ÊôöÈ§ê';
                    
                    try {
                        await ElMessageBox.confirm(
                            `Á°ÆÂÆöË¶ÅÊ∏ÖÈõ∂${mealName}‰∏çÂêÉ‰∫∫Êï∞ÂêóÔºüÊ≠§Êìç‰ΩúÂ∞ÜÂà†Èô§‰ªäÊó•ÊâÄÊúâ${mealName}‰∏çÂêÉËÆ∞ÂΩï„ÄÇ`,
                            'Á°ÆËÆ§Ê∏ÖÈõ∂',
                            {
                                confirmButtonText: 'Á°ÆÂÆö',
                                cancelButtonText: 'ÂèñÊ∂à',
                                type: 'warning',
                            }
                        );
                    } catch (error) {
                        return; // Áî®Êà∑ÂèñÊ∂à‰∫ÜÊìç‰Ωú
                    }

                    // ËÆæÁΩÆloadingÁä∂ÊÄÅ
                    if (mealType === 'lunch') {
                        this.clearingLunch = true;
                    } else {
                        this.clearingDinner = true;
                    }

                    try {
                        console.log('ÂèëÈÄÅÊ∏ÖÈõ∂ËØ∑Ê±Ç:', { mealType });
                        
                        const response = await fetch('/api/no-eat/clear', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                mealType: mealType
                            })
                        });
                        
                        console.log('Ê∏ÖÈõ∂ÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                        const result = await response.json();
                        console.log('Ê∏ÖÈõ∂ÂìçÂ∫îÁªìÊûú:', result);
                        
                        if (result.success) {
                            ElMessage.success(result.message);
                            // Âà∑Êñ∞ÁªüËÆ°Êï∞ÊçÆ
                            await this.loadOrderStats();
                        } else {
                            ElMessage.error(result.message || 'Ê∏ÖÈõ∂Â§±Ë¥•');
                        }
                    } catch (error) {
                        ElMessage.error('Ê∏ÖÈõ∂Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                        console.error('Ê∏ÖÈõ∂Â§±Ë¥•:', error);
                    } finally {
                        // ÈáçÁΩÆloadingÁä∂ÊÄÅ
                        if (mealType === 'lunch') {
                            this.clearingLunch = false;
                        } else {
                            this.clearingDinner = false;
                        }
                    }
                },
                formatTodayDate() {
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0');
                    const day = String(today.getDate()).padStart(2, '0');
                    return `${year}/${month}/${day}`;
                },
                refreshData() {
                    this.loadTodayMenu();
                    this.loadOrderStats();
                    this.loadCurrentPeople();
                    this.formattedTodayDate = this.formatTodayDate();
                    ElMessage.success('Êï∞ÊçÆÂ∑≤Âà∑Êñ∞');
                },
                getDayName() {
                    const days = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];
                    return days[new Date().getDay()];
                },
                getDayNameByNum(dayNum) {
                    const days = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];
                    return days[dayNum] || dayNum;
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>