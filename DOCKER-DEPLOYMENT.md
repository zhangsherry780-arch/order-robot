# Docker ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆ

æœ¬æ–¹æ¡ˆé€‚ç”¨äºæœåŠ¡å™¨æ— æ³•è”ç½‘çš„ç¯å¢ƒï¼Œé€šè¿‡Dockerå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒï¼Œåªéœ€åŒæ­¥ä¿®æ”¹çš„ä»£ç æ–‡ä»¶ã€‚

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

1. **è”ç½‘ç¯å¢ƒ**: æ„å»ºåŒ…å«æ‰€æœ‰ä¾èµ–çš„Dockeré•œåƒ
2. **ç¦»çº¿æœåŠ¡å™¨**: åŠ è½½é•œåƒå¹¶å¯åŠ¨å®¹å™¨ï¼ŒæŒ‚è½½ä»£ç æ–‡ä»¶
3. **æ—¥å¸¸æ›´æ–°**: åªéœ€åŒæ­¥ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå®¹å™¨è‡ªåŠ¨é‡å¯

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### è”ç½‘ç¯å¢ƒï¼ˆå¼€å‘æœºï¼‰
- Docker
- Docker Compose

### ç¦»çº¿æœåŠ¡å™¨
- Docker
- Docker Compose
- æ— éœ€Node.jsç¯å¢ƒ

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. è”ç½‘ç¯å¢ƒæ„å»ºé•œåƒ

```bash
# æ„å»ºDockeré•œåƒå¹¶å¯¼å‡º
./build-docker.sh [ç‰ˆæœ¬å·]

# ä¾‹å¦‚: ./build-docker.sh v1.0.0
# é»˜è®¤ç‰ˆæœ¬: ./build-docker.sh
```

æ­¤è„šæœ¬ä¼šç”Ÿæˆ:
- `order-robot-[ç‰ˆæœ¬].tar.gz` - Dockeré•œåƒæ–‡ä»¶

### 2. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨éƒ¨ç½²ç›®å½•:

#### å¿…éœ€æ–‡ä»¶
- `order-robot-[ç‰ˆæœ¬].tar.gz` - Dockeré•œåƒ
- `docker-compose.yml` - å®¹å™¨ç¼–æ’æ–‡ä»¶
- `deploy-offline.sh` - éƒ¨ç½²è„šæœ¬
- `sync-files.sh` - åŒæ­¥è„šæœ¬

#### ä»£ç æ–‡ä»¶
- `server.js` - ä¸»æœåŠ¡æ–‡ä»¶
- `config/` - é…ç½®ç›®å½•

- `public/` - é™æ€æ–‡ä»¶
- `database/` - æ•°æ®åº“ç›¸å…³
- `scripts/` - è„šæœ¬æ–‡ä»¶
- `.env.production` - ç”Ÿäº§ç¯å¢ƒé…ç½®
- `ecosystem.config.js` - PM2é…ç½®

### 3. ç¦»çº¿æœåŠ¡å™¨éƒ¨ç½²

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy-offline.sh [ç‰ˆæœ¬å·]

# ä¾‹å¦‚: ./deploy-offline.sh v1.0.0
```

## ğŸ“ æ–‡ä»¶æŒ‚è½½è¯´æ˜

Dockerå®¹å™¨é€šè¿‡ä»¥ä¸‹æ–¹å¼æŒ‚è½½æ–‡ä»¶:

```yaml
volumes:
  # åªè¯»æŒ‚è½½ - ä»£ç æ–‡ä»¶
  - ./server.js:/app/server.js:ro
  - ./config:/app/config:ro
  - ./public:/app/public:ro
  - ./database:/app/database:ro
  - ./scripts:/app/scripts:ro
  - ./.env.production:/app/.env.production:ro
  - ./ecosystem.config.js:/app/ecosystem.config.js:ro

  # è¯»å†™æŒ‚è½½ - æ•°æ®ç›®å½•
  - ./data:/app/data
  - ./logs:/app/logs
```

## ğŸ”„ æ—¥å¸¸æ›´æ–°æµç¨‹

### æ–¹æ¡ˆ1: æ‰‹åŠ¨åŒæ­¥

1. ä¿®æ”¹ä»£ç æ–‡ä»¶
2. ä¸Šä¼ ä¿®æ”¹çš„æ–‡ä»¶åˆ°æœåŠ¡å™¨
3. é‡å¯å®¹å™¨:
   ```bash
   docker-compose restart order-robot
   ```

### æ–¹æ¡ˆ2: è„šæœ¬åŒæ­¥

```bash
# è‡ªåŠ¨åŒæ­¥æ–‡ä»¶å¹¶é‡å¯æœåŠ¡
./sync-files.sh æœåŠ¡å™¨åœ°å€ [ç”¨æˆ·å] [æœåŠ¡å™¨è·¯å¾„]

# ä¾‹å¦‚:
./sync-files.sh 192.168.1.100 ubuntu /opt/order-robot
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f order-robot

# é‡å¯æœåŠ¡
docker-compose restart order-robot

# åœæ­¢æœåŠ¡
docker-compose down

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# è¿›å…¥å®¹å™¨
docker-compose exec order-robot sh
```

## ğŸ“Š ç›‘æ§å’Œå¥åº·æ£€æŸ¥

å®¹å™¨åŒ…å«å¥åº·æ£€æŸ¥æœºåˆ¶:
- æ£€æŸ¥é—´éš”: 30ç§’
- è¶…æ—¶æ—¶é—´: 10ç§’
- é‡è¯•æ¬¡æ•°: 3æ¬¡
- å¯åŠ¨æœŸé—´: 30ç§’

æŸ¥çœ‹å¥åº·çŠ¶æ€:
```bash
docker-compose ps
# æˆ–
docker inspect order-robot --format='{{.State.Health.Status}}'
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs order-robot

# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker build -t order-robot .
```

### æœåŠ¡æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥ç«¯å£æ˜ å°„
docker-compose ps

# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect order-robot_default
```

### æ–‡ä»¶æƒé™é—®é¢˜
```bash
# ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
chmod -R 755 config/ public/ database/ scripts/
chmod 644 server.js .env.production ecosystem.config.js
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

1. **é•œåƒå¤§å°ä¼˜åŒ–**: ä½¿ç”¨ `alpine` åŸºç¡€é•œåƒ
2. **ç¼“å­˜ä¼˜åŒ–**: åˆ†å±‚æ„å»ºï¼Œä¾èµ–å…ˆå®‰è£…
3. **æ•°æ®æŒä¹…åŒ–**: æ•°æ®ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœº
4. **æ—¥å¿—ç®¡ç†**: æ—¥å¿—æ–‡ä»¶æŒ‚è½½ï¼Œä¾¿äºæŸ¥çœ‹å’Œå¤‡ä»½

## ğŸ”’ å®‰å…¨å»ºè®®

1. ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨
2. åªè¯»æŒ‚è½½ä»£ç æ–‡ä»¶
3. å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
4. é…ç½®é˜²ç«å¢™è§„åˆ™
5. ä½¿ç”¨å¯†é’¥æ–‡ä»¶è€Œä¸æ˜¯å¯†ç SSH

## ğŸ“ ç‰ˆæœ¬ç®¡ç†

å»ºè®®çš„ç‰ˆæœ¬å·æ ¼å¼:
- ä¸»ç‰ˆæœ¬æ›´æ–°: `v1.0.0`, `v2.0.0`
- åŠŸèƒ½æ›´æ–°: `v1.1.0`, `v1.2.0`
- ä¿®å¤æ›´æ–°: `v1.1.1`, `v1.1.2`
- å¼€å‘ç‰ˆæœ¬: `v1.1.0-dev`, `v1.1.0-beta`

æ¯æ¬¡æ„å»ºéƒ½åº”è¯¥æ‰“ä¸Šç›¸åº”çš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾¿äºå›æ»šå’Œç®¡ç†ã€‚